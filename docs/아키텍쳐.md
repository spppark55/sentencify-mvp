

---

# **ì•„í‚¤í…ì²˜, ë°ì´í„°ìŠ¤í‚¤ë§ˆ, íŠ¸ëœì­ì…˜**

# **ğŸ“˜ PART 1 â€” ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜**

---

# **1-1 ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (v2.3)**

ë³¸ ì ˆì€ ë¬¸ì¥êµì • ì¶”ì²œ ì‹œìŠ¤í…œì˜ ì „ì²´ ê¸°ìˆ  êµ¬ì¡°ë¥¼ ì‹¤ì‹œê°„ ê²½ë¡œ(Real-time Path), ì €ì¥ì†Œ(Storage), ë°°ì¹˜ ê²½ë¡œ(Offline Path) ì„¸ ê´€ì ì—ì„œ í‘œí˜„í•œë‹¤.

ì´ ì•„í‚¤í…ì²˜ëŠ” Phase 1\~4 ì „ì²´ ê¸°ëŠ¥ì„ í¬í•¨í•˜ë©°, ê° Phaseì—ì„œ ìƒì„±Â·í™œìš©ë˜ëŠ” ëª¨ë“  ë°ì´í„° ìš”ì†Œ(A\~I ìŠ¤í‚¤ë§ˆ), ê·¸ë¦¬ê³  ë…ë¦½ì ì¸ ì»¨í…ìŠ¤íŠ¸ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸(E: Micro / Kâ†’F: Macro)ì„ ëª…í™•íˆ ë¶„ë¦¬í•œ ìµœì¢… êµ¬ì¡°ë‹¤.

ì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì€ ì‚¬ìš©ì ì…ë ¥ â†’ ì¶”ì²œ API â†’ ë¹„ë™ê¸° ë¡œê·¸ ì²˜ë¦¬ â†’ ETL íŒŒì´í”„ë¼ì¸ â†’ ìºì‹œ/DB â†’ ë‹¤ì‹œ APIë¡œ ì´ì–´ì§€ëŠ” íì‡„ ë£¨í”„ë¥¼ ì™„ì „í•œ í˜•íƒœë¡œ í‘œí˜„í•œë‹¤.

---

## **ğŸ§­ 1-1. ì‹œìŠ¤í…œ ì „ì²´ êµ¬ì¡° (Real-time \+ Offline \+ Storage)**

### **ğŸ’¡ ìƒˆë¡­ê²Œ ë°˜ì˜ëœ í•µì‹¬ ì‚¬í•­ (v2.3 ì—…ë°ì´íŠ¸)**

* **Rule Engine ($P\_{rule}$) ì˜êµ¬ ì‚­ì œ**: ë²¡í„° ê²€ìƒ‰($P\_{vec}$) ì¤‘ì‹¬ìœ¼ë¡œ ì‹œìŠ¤í…œ ê²½ëŸ‰í™” ë° ìœ ì§€ë³´ìˆ˜ íš¨ìœ¨ì„± ì¦ëŒ€.  
* **ì‹ ë¢°ë„ ê¸°ë°˜ ì ì‘í˜• ìŠ¤ì½”ì–´ë§ (Adaptive Scoring)**: ë¬¸ì„œ ì„±ìˆ™ë„(ê¸¸ì´)ì— ë”°ë¼ Macro($P\_{doc}$) ê°€ì¤‘ì¹˜($\\alpha$)ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì ˆ.  
* **Full-Logging êµ¬ì¡°**: ìµœì¢… ì ìˆ˜ì— ë°˜ì˜ë˜ì§€ ì•ŠëŠ” ìš”ì†Œ($P\_{doc}$ ë“±)ë¼ë„ ê³„ì‚°ëœ ê°’ê³¼ ê°€ì¤‘ì¹˜ëŠ” ë°˜ë“œì‹œ ë¡œê·¸(I)ì— ë‚¨ê²¨ ì¶”í›„ ì‹œë®¬ë ˆì´ì…˜(Shadowing)ì´ ê°€ëŠ¥í•˜ë„ë¡ í•¨.  
* **Macro Context**ëŠ” ë°˜ë“œì‹œ K.full\_document\_store â†’ F.document\_context\_cache ê²½ë¡œë¡œë§Œ ìƒì„±ë¨ (Eì™€ ì™„ì „ ë¶„ë¦¬).  
* **P\_user, P\_cluster ì¡°íšŒ**ëŠ” Phase 3 ì´ìƒì—ì„œë§Œ í™œì„±í™”.  
* **editor\_document\_snapshot â†’ K ì €ì¥ â†’ diff ê¸°ë°˜ ìºì‹œ ë¬´íš¨í™” ê·œì¹™(\>=10%) ì¶”ê°€.**  
* **A/B/Cë§Œ recommend\_session\_idë¥¼ ê³µìœ í•˜ë©° D(correction\_history)ëŠ” correction\_history\_idë¡œë§Œ ì—°ê²°ëœë‹¤.**  
* **F/G/J ìºì‹œëŠ” ëª¨ë‘ Redisì— ì €ì¥í•˜ë©° TTL/invalidated\_by\_diff/last\_updatedë¥¼ ìƒì„¸ ê´€ë¦¬.**

---

# **1-2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨**

ì½”ë“œ ìŠ¤ë‹ˆí«

graph TD  
  subgraph "ì‹¤ì‹œê°„ ê²½ë¡œ (Real-time Path)"  
      direction LR

      User(ì‚¬ìš©ì) \-- "1. ì¶”ì²œ ìš”ì²­ (HTTPS)\\n(doc\_id, context\_text, user\_id)" \--\> FE\["í”„ë¡ íŠ¸ì—”ë“œ\<br\>(ì›¹ ì—ë””í„°)"\]

      %% Phaseë³„ ì¡°íšŒ ë°˜ì˜  
      FE \-- "2. /recommend API í˜¸ì¶œ\\n(P\_vec / P\_doc? / P\_user? / P\_cluster?)" \--\> API\["ì¶”ì²œ API ì„œë²„"\]

      %% ìºì‹œ ê³„ì¸µ: 1.5(F), 2(G), 3(J)  
      API \-- "3. Macro ì¡°íšŒ (Phase1.5+)\\nF.document\_context\_cache(doc\_id)" \--\> CacheF\["F ë§¤í¬ë¡œ ìºì‹œ"\]  
      API \-- "4. User Profile ì¡°íšŒ (Phase2+)\\nG.user\_profile(user\_id)" \--\> CacheG\["G í”„ë¡œí•„ ìºì‹œ"\]  
      API \-- "5. Cluster Profile ì¡°íšŒ (Phase3+)\\nkey \= G.user\_profile.cluster\_id" \--\> CacheJ\["J í´ëŸ¬ìŠ¤í„° ìºì‹œ"\]

			API \--\> EmbeddingModel(Micro-Window ì„ë² ë”©)  
			API \--\> ParaphrasingLLM(ì‹¤í–‰-B ë‹¨ê³„)  
			ETL \--\> MacroLLM(Kâ†’F ë¶„ì„)

      API \-- "6. Vector Search (Phase1+)\\nE.context\_block(context\_hash)" \--\> VDB\["E ë¬¸ë§¥ VectorDB"\]

      API \-- "7. P\_final ê³„ì‚°\\n(1-Î±)P\_vec \+ Î±P\_doc \+ P\_user \+ P\_cluster" \--\> API

      API \-- "8. ì¶”ì²œ ê²°ê³¼ ë°˜í™˜\\n(insert\_id, ì¶”ì²œ ì˜µì…˜)" \--\> FE  
      FE \-- "9. ì‚¬ìš©ìì—ê²Œ ì¶”ì²œ ì˜µì…˜ í‘œì‹œ" \--\> User

      API \-- "10. ë¹„ë™ê¸° ì´ë²¤íŠ¸ ë°œí–‰\\n(editor\_recommend\_options, recommend\_log)" \--\> MQ\["ë©”ì‹œì§€ í\\nKafka/SQS"\]

      User \-- "11. ë¬¸ì„œ ì €ì¥/íƒ€ì´í•‘" \--\> FE  
      FE \-- "12. editor\_document\_snapshot ë°œí–‰" \--\> MQ  
  end

  %% Storage Layer  
  subgraph "ë°ì´í„° ì €ì¥ì†Œ (Storage)"  
      MQ \-- "13. (A) ì¶”ì²œ ì´ë²¤íŠ¸ ì €ì¥" \--\> DWH\["A/B/C/E/I/H/G\\në°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤(BigQuery)"\]  
      MQ \-- "14. (I) recommend\_log ì €ì¥" \--\> DWH  
      MQ \-- "15. (E) context\_block ì €ì¥" \--\> ContextDB\["E ë¬¸ë§¥ DB (Vector Store)"\]  
      MQ \-- "16. (K) full\_document\_store ì €ì¥" \--\> K\_DB\["K ì›ë³¸ ë¬¸ì„œ DB (MongoDB)"\]

      FE \-- "17. (B/C/D) Ground Truth ì €ì¥" \--\> MainDB\["D ë©”ì¸ DB (Postgres/Mongo)"\]  
  end

  %% Offline Path  
  subgraph "ë°°ì¹˜ ê²½ë¡œ (Offline Path / Phase 1.5+)"  
      ETL\["ETL íŒŒì´í”„ë¼ì¸ (Airflow/LLM)"\]

      %% Macro Context ë°°ì¹˜  
      K\_DB \-- "18a. ë¬¸ì„œ ì›ë³¸ ì½ê¸°\\n(diff ratio ê³„ì‚° í¬í•¨)" \--\> ETL  
      ETL \-- "19a. LLM ë¶„ì„ â†’ Macro ìºì‹œ ìƒì„±\\n(macro\_category\_hint, macro\_topic)" \--\> CacheF

      %% User Profile \+ Cluster  
      DWH \-- "18b. A/B/C/E/I ë¡œê·¸ ì½ê¸°" \--\> ETL  
      MainDB \-- "18c. (D) correction\_history ì½ê¸°" \--\> ETL

      ETL \-- "19b. training\_examples(H) ìƒì„±" \--\> DWH  
      ETL \-- "19c. user\_profile(G) ìƒì„±" \--\> CacheG  
      ETL \-- "19d. cluster\_profile(J) ìƒì„±" \--\> CacheJ  
  end

  style CacheF fill:\#fff2cc  
  style CacheG fill:\#fff2cc  
  style CacheJ fill:\#fff2cc  
  style User fill:\#cde4ff  
  style FE fill:\#cde4ff  
  style API fill:\#cde4ff  
  style ETL fill:\#d5e8d4

---

# **1-3. Real-time Path ìƒì„¸ ì„¤ëª…**

### **(1) ì¶”ì²œ ìš”ì²­ (User â†’ FE â†’ API)**

â€¢ FEëŠ” ë‹¤ìŒ ì •ë³´ë¥¼ APIë¡œ ì „ì†¡í•œë‹¤:  
doc\_iduser\_idselected\_textcontext: { "prev": "...", "next": "..." }  
(context\_hashì™€ context\_textëŠ” FEê°€ ì•„ë‹Œ ë°±ì—”ë“œ API ì„œë²„ê°€ ìƒì„±/ê³„ì‚°í•¨)  
ì´ ìš”ì²­ì´ **ì¶”ì²œ íŠ¸ëœì­ì…˜(A)ì˜ ì‹œì‘ì **ì´ ëœë‹¤.

recommend\_session\_idëŠ” í•­ìƒ API ì„œë²„ê°€ ìƒì„±í•œë‹¤.

FEëŠ” ì‚¬ìš©ì ë“œë˜ê·¸ ì‹œ session\_idë¥¼ ìƒì„±í•˜ì§€ ì•Šìœ¼ë©°,

API ì‘ë‹µì„ ë°›ì€ ì´í›„ B/C ì´ë²¤íŠ¸ì— session\_idë¥¼ í¬í•¨í•˜ì—¬ ì „ì†¡í•œë‹¤.

---

### **(2) ì¶”ì²œ API ë‚´ë¶€ ë¡œì§ êµ¬ì„±**

APIëŠ” Phaseì— ë”°ë¼ ë‹¤ìŒ ìš”ì†Œë¥¼ ì¡°íšŒí•œë‹¤:

| Phase | ì‚¬ìš©ë˜ëŠ” ìš”ì†Œ | ì¶œì²˜ |
| :---- | :---- | :---- |
| **1.0** | P\_vec | context\_block(E) |
| **1.5** | \+ P\_doc | document\_context\_cache(F) |
| **2.0** | \+ user\_profile ê¸°ë°˜ feature | user\_profile(G) |
| **3.0** | \+ P\_user, \+ P\_cluster | G(user\_profile), J(cluster\_profile) |
| **4.0** | \+ style/tone generator | ëª¨ë“  ë°ì´í„° ê¸°ë°˜ |

---

### **(3) Vector Search (P\_vec) â€” E.context\_block ê¸°ë°˜**

* context\_hashë¥¼ keyë¡œ Eì—ì„œ embeddingì„ ê°€ì ¸ì˜¤ê±°ë‚˜  
* context\_textë¥¼ ì¦‰ì„ ì„ë² ë”©í•˜ì—¬ KNN ê²€ìƒ‰ ìˆ˜í–‰  
  context\_textëŠ” EmbeddingModel(embedding\_v1)ë¡œ ì„ë² ë”©ì„ ìƒì„±í•œ ë’¤,  
  í•´ë‹¹ ë²¡í„°ë¡œ VectorDB(KNN) ê²€ìƒ‰ì„ ìˆ˜í–‰í•œë‹¤.  
  ëª¨ë“  ì„ë² ë”©ì€ embedding\_versionì„ í¬í•¨í•´ì•¼ í•œë‹¤.

**EëŠ” Microì˜ ì „ìš© ì €ì¥ì†Œì´ë©° Macro(Kâ†’F)ì™€ ì—°ê²°ë˜ì§€ ì•ŠìŒ.**

---

### **(4) Macro Context ì¡°íšŒ (P\_doc) â€” F.document\_context\_cache**

ì¡°íšŒ í‚¤: **doc\_id**

ë°˜í™˜ ê°’:

* macro\_category\_hint  
* macro\_topic  
* cache\_hit  
* last\_updated, valid\_until

**Cache ë¬´íš¨í™” ì¡°ê±´ (v2.2):**

* TTL ë§Œë£Œ  
* ë˜ëŠ” diff\_ratio \>= **10%** (ì¦‰ê° ë¬´íš¨í™” ë° ì¬ê³„ì‚° ìš”ì²­)

---

### **(5) User Profile ì¡°íšŒ (P\_user) â€” G.user\_profile**

ì¡°íšŒ í‚¤: **user\_id**

ë°˜í™˜ ê°’:

* preferred\_category\_vector  
* preferred\_strength\_vector  
* preferred\_language\_vector  
* recommend\_accept\_rate  
* user\_embedding\_v1

---

### **(6) Cluster Profile ì¡°íšŒ (P\_cluster) â€” J.cluster\_profile**

ì¡°íšŒ í‚¤: **cluster\_id**

ë°˜í™˜ ê°’:

* centroid\_embedding  
* ì¹´í…Œê³ ë¦¬Â·ê°•ë„Â·ì–¸ì–´ ë¶„í¬ ë²¡í„°  
* last\_updated

cluster\_idëŠ” user\_profile(G)ì— ì €ì¥ëœ ê°’ì´ë©°

APIëŠ” ë¨¼ì € user\_profileì„ ì¡°íšŒí•œ ë’¤ cluster\_idë¥¼ ì–»ëŠ”ë‹¤.

ê·¸ í›„ cluster\_profile(J)ë¥¼ ì¡°íšŒí•œë‹¤.

---

### **(7) ìµœì¢… ì ìˆ˜ ê³„ì‚° (P\_final)**

\# v2.3 ë³€ê²½: ë™ì  ê°€ì¤‘ì¹˜ ì ìš©  
\# alpha \= f(doc\_length) (ë¬¸ì„œ ì„±ìˆ™ë„)

P\_final \= (1 \- alpha) \* P\_vec  
        \+ alpha \* P\_doc  
        \+ w\_user \* P\_user  
        \+ w\_cluster \* P\_cluster

* Phase 1.5 ì´ˆê¸°ë‚˜ í…ŒìŠ¤íŠ¸ ì‹œ alphaë¥¼ 0ìœ¼ë¡œ ì„¤ì •í•˜ë©´, $P\_{doc}$ì€ ê³„ì‚°ë˜ì§€ë§Œ $P\_{final}$ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤. (Shadow Effect)  
* ëª¨ë“  ê³„ì‚°ëœ ì ìˆ˜ì™€ ê°€ì¤‘ì¹˜ëŠ” \*\*recommend\_log(I)\*\*ì— ê¸°ë¡ë˜ì–´ì•¼ í•œë‹¤.

---

### **(8) ë¹„ë™ê¸° ë°ì´í„° ì €ì¥**

APIëŠ” ê²°ê³¼ë¥¼ FEë¡œ ë°˜í™˜í•œ ë’¤,

**ë¹„ë™ê¸° íë¥¼ í†µí•´ A, I, Eë¥¼ ì €ì¥í•œë‹¤.**

* A: editor\_recommend\_options  
* I: recommend\_log  
* E: context\_block  
* K: editor\_document\_snapshot â†’ full\_document\_store  
  editor\_document\_snapshotëŠ” MQë¡œ ì „ë‹¬ë˜ë©°  
  MQ consumerëŠ” ë‹¤ìŒ ìˆœì„œë¡œ full\_document\_store(K)ë¥¼ ê°±ì‹ í•œë‹¤:  
  1. K.latest\_full\_text ì½ê¸°  
  2. K.previous\_full\_text \= ê¸°ì¡´ latest\_full\_text  
  3. K.latest\_full\_text \= snapshot.full\_text  
  4. diff\_ratio ê³„ì‚°  
  5. blocks ì¬êµ¬ì„±  
  6. last\_synced\_at ì—…ë°ì´íŠ¸

ì´ ì €ì¥ êµ¬ì¡°ê°€ Phase 2â†’3â†’4ì˜ í•™ìŠµ ê¸°ë°˜ì´ ëœë‹¤.

---

# **1-4. Storage Layer ìƒì„¸ ì„¤ëª…**

### **(A/B/C/I/E/H/G ì €ì¥ì†Œ â€” BigQuery ê¸°ë°˜ DWH)**

ëŒ€ê·œëª¨ ë¶„ì„ ë° ETL íŒŒì´í”„ë¼ì¸ì˜ ê¸°ë°˜.

### **(K â€” MongoDB ê¸°ë°˜ ì›ë³¸ ë¬¸ì„œ ì €ì¥)**

* ë¬¸ì„œ ì „ì²´ ë‹¨ìœ„ ì €ì¥  
* diff ê¸°ë°˜ ìºì‹œ ë¬´íš¨í™” ì •ì±…ì— ì‚¬ìš©  
* Macro Context ìƒì„±ì˜ ìœ ì¼í•œ ì†ŒìŠ¤

### **(D â€” Postgres/Mongo ê¸°ë°˜ correction\_history)**

ê¸°ì—… Ground Truth ì €ì¥ì†Œ

correction\_history(D)ëŠ” editor\_selected\_paraphrasing(C) ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ì§í›„ MQ consumerê°€ ìƒì„±í•œë‹¤.

B(editor\_run\_paraphrasing)ëŠ” D ìƒì„±ì— ê´€ì—¬í•˜ì§€ ì•ŠëŠ”ë‹¤.

---

# **1-5. Offline / Batch Path ìƒì„¸ ì„¤ëª…**

### **(1) K â†’ F Macro Context Generation**

* Kì˜ full\_document\_storeë¥¼ ì½ê³   
* diff ratio ê³„ì‚° â†’ diff \>= 10% ì‹œ ìºì‹œ ë¬´íš¨í™”  
* LLM ë¶„ì„ í›„ F.document\_context\_cache ì—…ë°ì´íŠ¸

---

### **(2) A/B/C/D/E/I/H/G â†’ ETL íŒŒì´í”„ë¼ì¸**

ETLì€ ë‹¤ìŒì„ ìƒì„±í•œë‹¤:

* training\_examples(H)  
* user\_profile(G)  
* cluster\_profile(J)  
* Macro ì¬ê³„ì‚°(F)

---

# **1-6. ìºì‹œ ê³„ì¸µ (F/G/J) ì •ì±…**

| ìºì‹œ | TTL | ì—…ë°ì´íŠ¸ ì¡°ê±´ | ë¬´íš¨í™” ì¡°ê±´ |
| :---- | :---- | :---- | :---- |
| **F(document\_context\_cache)** | ê¸°ë³¸ TTL \= 1ì‹œê°„ |  |  |
| ê·¸ëŸ¬ë‚˜ ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ TTLì„ ë‹¨ì¶•í•œë‹¤: |  |  |  |

1. ë¬¸ì„œ ìµœê·¼ ì €ì¥ ì‹œì ì´ 5ë¶„ ì´ë‚´ë¼ë©´ â†’ TTL \= 5ë¶„  
2. snapshot ìƒì„± ë¹ˆë„ê°€ ë§¤ìš° ë†’ë‹¤ë©´(10ë¶„ ë‚´ 3íšŒ ì´ìƒ) â†’ TTL \= 3ë¶„  
3. ë¬¸ì„œê°€ ê±°ì˜ í¸ì§‘ë˜ì§€ ì•ŠëŠ” ê²½ìš°(30ë¶„ ì´ìƒ ë³€í™” ì—†ìŒ) â†’ TTL \= 1ì‹œê°„ ìœ ì§€

ì¦‰, ë¬¸ì„œ í¸ì§‘ í™œë™ëŸ‰ì„ ê¸°ë°˜ìœ¼ë¡œ TTLì„ ë™ì ìœ¼ë¡œ ì¡°ì •í•œë‹¤.  
| diff\_ratio\>=10% or TTL |  
| G(user\_profile) | ë¬´í•œ (0) | ETL ë°°ì¹˜ ì‹¤í–‰ ì‹œ ë®ì–´ì“°ê¸°(Overwrite) | ETL ì‹¤íŒ¨ ì‹œ ì´ì „ ê°’ ì‚¬ìš© |  
| J(cluster\_profile) | ë¬´í•œ (0) | ETL ë°°ì¹˜ ì‹¤í–‰ ì‹œ ë®ì–´ì“°ê¸°(Overwrite) | clustering ë³€ê²½ |

---

# **ğŸ“˜ PART 2 â€” Phaseë³„ ìƒì„¸ ëª…ì„¸ (v2.3 ì™„ì „ ì¬ì‘ì„±ë³¸)**

*(Phase 1 â†’ Phase 1.5 â†’ Phase 2 â†’ Phase 3 â†’ Phase 4\)*

---

# **ğŸŸ¦ Phase 1: ì‹¤ì‹œê°„ ì¶”ì²œ MVP \+ Hooks ìˆ˜ì§‘ (v1.0)**

**ëª©í‘œ:**

ì‚¬ìš©ìê°€ ë¬¸ì¥ì„ ë“œë˜ê·¸í–ˆì„ ë•Œ, **Vector ê¸°ë°˜** ì ìˆ˜ë¥¼ í†µí•´ ì¦‰ê°ì ì¸ ì¹´í…Œê³ ë¦¬ ì¶”ì²œì„ ì œê³µí•œë‹¤.

ë™ì‹œì— ë¯¸ë˜ì˜ ê³ ë„í™”ë¥¼ ìœ„í•´ ëª¨ë“  í•µì‹¬ â€œHooks(ë°ì´í„° ê³ ë¦¬)â€ë¥¼ ìˆ˜ì§‘í•œë‹¤.

---

## **ğŸ”µ 1\. Phase 1ì—ì„œ ë‹¬ì„±í•´ì•¼ í•˜ëŠ” ê²ƒ**

| í•­ëª© | ì„¤ëª… |
| :---- | :---- |
| **ì‹¤ì‹œê°„ ì¶”ì²œ ë¡œì§(P\_vec)** | ìœ ì €ê°€ ë“œë˜ê·¸í•œ ë¬¸ë§¥ì˜ ë²¡í„° ìœ ì‚¬ë„ ê¸°ë°˜ ì¶”ì²œ |
| **Micro-Context ìˆ˜ì§‘(E.context\_block)** | "ì„ íƒ êµ¬ê°„ ìœˆë„ìš°" ë‹¨ìœ„ì˜ ë¬¸ë§¥/ì„ë² ë”© ì €ì¥ |
| **doc\_id ê¸°ë°˜ ìˆ˜ì§‘ ì²´ê³„ ë§ˆë ¨** | Macro/Personalization ê¸°ë°˜ |
| **A/B/C/D íŠ¸ëœì­ì…˜ ì—°ê²° êµ¬ì¡° í™•ë¦½** | session ë‹¨ìœ„ consistency í™•ë³´ |
| **Ground Truth(D) ê¸°ë°˜ ë¼ë²¨ ìˆ˜ì§‘** | field/intensity/selected\_index/user\_prompt |
| **API/Schema version ê´€ë¦¬ ì‹œì‘** | í–¥í›„ í™•ì¥ ëŒ€ë¹„ |

Phase 1 ìì²´ëŠ” **ì¶”ì²œì˜ ì •ë°€ë„**ë³´ë‹¤ **ë°ì´í„° ìˆ˜ì§‘ êµ¬ì¡°ì˜ ì™„ì„±ë„**ì— ë°©ì ì´ ìˆë‹¤.

---

## **ğŸŸ¦ 2\. Phase 1 ì•„í‚¤í…ì²˜ íë¦„**

### **1\) ì‚¬ìš©ì â†’ FE â†’ API ìš”ì²­**

ì‚¬ìš©ìê°€ ë¬¸ì¥ì„ ë“œë˜ê·¸í•˜ë©´ FEëŠ” ë‹¤ìŒì„ APIë¡œ ë³´ë‚¸ë‹¤:

* doc\_id  
* context\_text  
* context\_hash  
* user\_id  
* api\_version, schema\_version

recommend\_session\_idëŠ” í•­ìƒ API ì„œë²„ê°€ ìƒì„±í•œë‹¤.

FEëŠ” API ì‘ë‹µì„ ë°›ì€ ì´í›„ B/C ì´ë²¤íŠ¸ì— í•´ë‹¹ session\_idë¥¼ í¬í•¨í•´ ì „ì†¡í•œë‹¤.

â€¢ ì´ session\_idëŠ” **A/B/C** ì´ë²¤íŠ¸ë¥¼ í•˜ë‚˜ë¡œ ë¬¶ëŠ”ë‹¤. (DëŠ” correction\_history\_idë¡œ ì—°ê²°)

---

### **2\) ì¶”ì²œ ì—”ì§„ â€” P\_vec ê³„ì‚°**

context\_text â†’ embedding\_v1

embedding ê²€ìƒ‰:

* KNN(top\_k=15)  
* Synthetic DB ê¸°ë°˜  
* cosine similarity ë°˜ì˜

ì¶œë ¥:

P\_vec \= { category:score }

---

### **3\) P\_final \= P\_vec**

Phase 1ì—ì„œëŠ” $P\_{rule}$ì€ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©°, Macro(P\_doc), ê°œì¸í™”(P\_user), í´ëŸ¬ìŠ¤í„°(P\_cluster)ëŠ” **ë°ì´í„° ìˆ˜ì§‘ ë‹¨ê³„**ì´ë¯€ë¡œ ì¶”ì²œ ì ìˆ˜ì—ëŠ” ë°˜ì˜í•˜ì§€ ì•ŠëŠ”ë‹¤.

---

### **4\) ì¶”ì²œ ê²°ê³¼ ë°˜í™˜ ë° A ì´ë²¤íŠ¸ ìƒì„±**

A ì´ë²¤íŠ¸ \= editor\_recommend\_options

ì €ì¥ë˜ëŠ” ì£¼ìš” í•„ë“œ:

* insert\_id (PK)  
* recommend\_session\_id  
* doc\_id  
* context\_hash  
* reco\_category\_input  
* P\_vec  
* model\_version  
* api\_version / schema\_version

---

### **5\) ë¬¸ì„œ Hooks ìˆ˜ì§‘: context\_block(E)**

ë¹„ë™ê¸° íì—ì„œ ë‹¤ìŒ ì‘ì—… ì‹¤í–‰:

* ë¬¸ë§¥ í…ìŠ¤íŠ¸ preview ì €ì¥  
* embedding\_v1 ì €ì¥  
* embedding\_version \= "v1.0"

---

### **6\) ì‹¤í–‰(B) / ì„ íƒ(C) / ê¸°ë¡(D) ì—°ê²°**

A â†’ B â†’ C â†’ DëŠ” ë‹¤ìŒ ê´€ê³„ë¡œ ì—°ê²°ëœë‹¤:

* **A/B/C** ì´ë²¤íŠ¸ëŠ” ë™ì¼í•œ recommend\_session\_id ê³µìœ   
* BëŠ” source\_recommend\_event\_idë§Œ ì €ì¥í•˜ë©° correction\_history\_idë¥¼ ê°–ì§€ ì•ŠëŠ”ë‹¤.  
  D(correction\_history)ëŠ” C(editor\_selected\_paraphrasing)ê°€ ë°œìƒí•˜ëŠ” ìˆœê°„ ìƒì„±ë˜ë©°,  
  ìƒì„±ëœ D.\_idê°€ C.correction\_history\_idì— ì €ì¥ëœë‹¤.  
* DëŠ” ìµœì¢… Ground Truth

---

## **ğŸŸ¦ 3\. Phase 1ì—ì„œì˜ ë°ì´í„° ë° ìŠ¤í‚¤ë§ˆ**

### **ìƒì„±:**

* E.context\_block  
* A.editor\_recommend\_options  
* I.recommend\_log

### **í™œìš©:**

* Synthetic embedding DB  
* D.correction\_history (ê¸°ì¡´)

---

## **ğŸŸ¦ 4\. Phase 1 ì™„ë£Œ ê¸°ì¤€**

* P\_vec ê¸°ë°˜ ì¶”ì²œì´ 300ms ì´ë‚´ ì‘ë™  
* E.context\_block ìƒì„±ë¥  99% ì´ìƒ  
* recommend\_session\_id ê¸°ë°˜ì˜ Aâ€“Bâ€“Câ€“D ì²´ì¸ ì„±ê³µë¥  99%  
* schema\_version backward-compatibility ê²€ì¦ ì™„ë£Œ

---

---

# **ğŸŸ¦ğŸŸ© Phase 1.5: Macro Context Hybrid (v1.5)**

**ëª©í‘œ:**

ë¬¸ì„œì˜ ë¶€ë¶„(Micro) ëŒ€ì‹  \*\*ì „ì²´ ë¬¸ì„œ(Macro)\*\*ì— ê¸°ë°˜í•œ ì¶”ì²œ ì„±ëŠ¥ í–¥ìƒ.

íŠ¹ì • ë¬¸ì¥ë§Œ ë³´ê³  ì˜¤ë¥˜ë‚œ ì¹´í…Œê³ ë¦¬ë¥¼ **ë¬¸ì„œ ë‹¨ìœ„ë¡œ ë³´ì •**í•˜ëŠ” íš¨ê³¼.

---

## **1\. Phase 1.5 í•µì‹¬ ê°œë… ì •ë¦¬**

### **â— ë¬¸ì„œ ì „ì²´(Macro)ì™€ ë¬¸ì¥(Micro)ì€ ì™„ì „íˆ ë‹¤ë¥¸ íŒŒì´í”„ë¼ì¸ì´ë‹¤.**

| í•­ëª© | Micro (E) | Macro (Kâ†’F) |
| :---- | :---- | :---- |
| ì €ì¥ ì‹œì  | A ì´ë²¤íŠ¸ ì§í›„ | FE ë¬¸ì„œ ì €ì¥ ì‹œ |
| ì €ì¥ ë‹¨ìœ„ | ì„ íƒ ìœˆë„ìš° | ë¬¸ì„œ ì „ì²´ |
| ì €ì¥ ìœ„ì¹˜ | E.context\_block | K.full\_document\_store |
| ë¶„ì„ ë°©ì‹ | embedding ê²€ìƒ‰(KNN) | LLM ê¸°ë°˜ ë¬¸ì„œ ìš”ì•½/í† í”½ ë¶„ë¥˜ |
| ì‹¤ì‹œê°„ ì¡°íšŒ | Vector Search | K-V Cache ì¡°íšŒ |
| ì¶”ì²œ ë°˜ì˜ | P\_vec | P\_doc |

---

## **2\. Phase 1.5 ìƒì„¸ ê¸°ëŠ¥ ì„¤ëª…**

## **(1) K.full\_document\_store ì €ì¥ â€” ë¬¸ì„œ ì›ë³¸ ì €ì¥ Hook**

FEëŠ” ë¬¸ì„œ ì €ì¥ ë˜ëŠ” ìë™ ì €ì¥ ì‹œì ë§ˆë‹¤ ë‹¤ìŒ ì´ë²¤íŠ¸ ë°œí–‰:

* editor\_document\_snapshot  
* diff ê¸°ë°˜ ì—…ë°ì´íŠ¸  
  snapshot.prev\_full\_textëŠ” ì„œë²„ê°€ K.latest\_full\_textë¥¼ ì½ì–´ ì±„ìš´ ê°’ì´ë©°  
  FEì—ì„œ ì „ë‹¬í•˜ì§€ ì•ŠëŠ”ë‹¤.  
* MongoDB(K)ì— ì €ì¥

K í…Œì´ë¸” êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ìŒ:

doc\_id  
blocks\[\]  
last\_synced\_at

v2.2 ì—…ë°ì´íŠ¸: diff\_ratio ê³„ì‚°ì„ ìœ„í•´ ì´ì „ ë²„ì „ì˜ ë¬¸ì„œ ì¡°ê°ì„ í•¨ê»˜ ì €ì¥í•˜ëŠ” êµ¬ì¡°ë¡œ í™•ì¥ ê°€ëŠ¥.

---

## **(2) ETL: K â†’ LLM â†’ F.document\_context\_cache**

ì „ë¬¸ LLMì— full\_textë¥¼ ì „ë‹¬í•˜ì—¬ ë‹¤ìŒ ì •ë³´ ìƒì„±:

* macro\_topic  
* macro\_category\_hint  
* ë¬¸ì„œ í’ˆì§ˆ í˜•ì‹(Optional)  
* updated\_at  
* valid\_until(TTL)  
* invalidated\_by\_diff (v2.2)  
* diff\_ratio (v2.2)

LLM outputì€ K-V êµ¬ì¡°ë¡œ ë³€í™˜ë˜ì–´ Redis(F)ì— ì €ì¥ëœë‹¤.

---

## **(3) ì¶”ì²œ ë¡œì§ ì—…ê·¸ë ˆì´ë“œ (P\_doc í†µí•© ë° ë™ì  ê°€ì¤‘ì¹˜)**

Phase 1.5ì—ì„œ ì¶”ì²œ í•¨ìˆ˜ëŠ” \*\*ë¬¸ì„œ ì„±ìˆ™ë„(Maturity)\*\*ì— ë”°ë¼ ê°€ì¤‘ì¹˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì ˆí•œë‹¤.

\# ì˜ì‚¬ì½”ë“œ (Pseudo-code)  
maturity\_score \= calculate\_maturity(doc\_length) \# 0.0 \~ 1.0 (Log Scale)  
alpha \= BASE\_ALPHA \* maturity\_score             \# BASE\_ALPHA \= 0.4 (ì˜ˆì‹œ)

P\_final \= (1 \- alpha) \* P\_vec \+ alpha \* P\_doc

* **Cold Start (0\~50ì):** $\\alpha \= 0$. Micro Context(P\_vec)ì— 100% ì˜ì¡´.  
* **Growing (50\~500ì):** ë¬¸ì„œ ì–‘ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ $\\alpha$ ì ì§„ì  ì¦ê°€.  
* **Mature (500ì+):** ìµœëŒ€ $\\alpha$ ì ìš©. P\_docì´ ê°•ë ¥í•œ ê°€ì´ë“œë¼ì¸(Guideline)ìœ¼ë¡œ ì‘ìš©.

---

## **(4) ìºì‹œ ë¬´íš¨í™” ê·œì¹™ (v2.2 ì™„ì „íŒ)**

| ì¡°ê±´ | ì„¤ëª… |
| :---- | :---- |
| diff\_ratio \>= 0.10 | ì¦‰ì‹œ ë¬´íš¨í™” ë° ìºì‹œ ì¬ìƒì„± ì˜ˆì•½ |
| TTL ë§Œë£Œ | ê¸°ë³¸ ë§Œë£Œ ì •ì±… (ì˜ˆ: 1ì‹œê°„) |
| doc\_id ì†Œìœ ìê°€ ì–¸ì–´ ì„¤ì • ë³€ê²½ | ì–¸ì–´ ê¸°ë°˜ ì¹´í…Œê³ ë¦¬ ëª¨ë¸ì—ì„œ í•„ìš” |

---

## **(5) A ì´ë²¤íŠ¸ í™•ì¥**

A.editor\_recommend\_optionsì— ë‹¤ìŒ í•„ë“œë¥¼ ì¶”ê°€:

* P\_doc  
* applied\_weight\_doc (ì‹¤ì œ ì ìš©ëœ alpha ê°’)  
* doc\_maturity\_score  
* cache\_hit (F ì¡°íšŒ ì—¬ë¶€)  
* api\_version / schema\_version  
* recommend\_session\_id  
* "embedding\_version": "string"  
* "llm\_version": "string" (ì„ íƒ)

---

## **3\. Phase 1.5 ì™„ë£Œ ê¸°ì¤€**

* F.cache ìƒì„±ë¥  97% ì´ìƒ  
* P\_doc ì ìˆ˜ ë°˜ì˜ ë¡œì§ ë° ë™ì  ê°€ì¤‘ì¹˜ ì •í™•ì„± ê²€ì¦  
* Macro ìºì‹œ ë¬´íš¨í™” ì •ì±… ì •ìƒ ì‘ë™ (diff-triggered reset)

---

---

# **ğŸŸ¦ğŸŸ¨ Phase 2: ë°ì´í„° ì¶•ì  / í•™ìŠµ íŒŒì´í”„ë¼ì¸ (v2.0)**

**ëª©í‘œ:**

Phase 1.5ê¹Œì§€ ìˆ˜ì§‘ëœ A/B/C/D/E/K/I ë¡œê·¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ

\*\*í•™ìŠµìš© ë°ì´í„°(training\_examples)\*\*ì™€

\*\*ì‚¬ìš©ì í”„ë¡œí•„(user\_profile)\*\*ì„ ìƒì„±í•˜ê³ 

ì‹œìŠ¤í…œì„ ë°ì´í„° ê¸°ë°˜ ì¶”ì²œ ì²´ê³„ë¡œ ì „í™˜í•œë‹¤.

---

## **ğŸ”µ 1\. Phase 2ì˜ í•µì‹¬ ë³€í™”**

| ê¸°ëŠ¥ | ì„¤ëª… |
| :---- | :---- |
| **training\_examples ìƒì„± (H)** | A/B/C/D/E/F ì¡°ì¸ì„ í†µí•´ supervision ìƒì„± |
| **user\_profile ìƒì„± (G)** | ì‚¬ìš©ìë³„ ì„ í˜¸/í–‰ë™/ì–¸ì–´ íŒ¨í„´ ì§‘ê³„ |
| **Vector DB Hybrid ì „í™˜** | synthetic â†’ real embedding ì¤‘ì‹¬ êµ¬ì¡° |
| **Session consistency ê²€ì¦** | ëª¨ë“  A/B/C/D ì´ë²¤íŠ¸ì˜ recommend\_session\_id ê²€ì¦ |
| **Monitoring ëŒ€ì‹œë³´ë“œ êµ¬ì¶•** | latency, cache hit, accept\_rate ì¶”ì  |

---

## **ğŸŸ¦ 2\. Phase 2 í•™ìŠµ ë°ì´í„° ìƒì„±(H)**

HëŠ” ë‹¤ìŒ ì†ŒìŠ¤ë¡œ ìƒì„±ëœë‹¤:

| ì†ŒìŠ¤ | ëª©ì  |
| :---- | :---- |
| A(editor\_recommend\_options) | Input: ì¶”ì²œê°’, ëª¨ë¸ ì ìˆ˜ |
| B(editor\_run\_paraphrasing) | Label: target\_language |
| C(editor\_selected\_paraphrasing) | Label: was\_accepted |
| D(correction\_history) | Label: field, intensity, selected\_index, user\_prompt |
| E(context\_block) | Input: context\_embedding |
| F(document\_context\_cache) | Input: macro\_category\_hint |

---

## **ğŸ”§ Session Consistency Rule (v2.2)**

if (abs(A.timestamp \- B.timestamp) \> 5s) â†’ low\_consistency  
if (C.was\_accepted \== false and D.selected\_index \!= null) â†’ inconsistency error  
if (B.source\_id \!= A.insert\_id) â†’ drop

ëª¨ë“  training\_examplesëŠ” consistency\_flagë¥¼ ê°€ì§„ë‹¤:

* high  
* low (í•™ìŠµ ì œì™¸)

---

## **ğŸŸ¦ 3\. Phase 2 User Profile ìƒì„±(G)**

ê° ì‚¬ìš©ì ê¸°ì¤€ ì§‘ê³„:

| í•„ë“œ | ì„¤ëª… |
| :---- | :---- |
| preferred\_category\_vector | ì „ì²´ ì¹´í…Œê³ ë¦¬ë¶„í¬ ë²¡í„° (ê³ ì • ê¸¸ì´) |
| preferred\_strength\_vector | ê°•ë„ ë¶„í¬ |
| preferred\_language\_vector | ì–¸ì–´ ë¶„í¬ |
| recommend\_accept\_rate | ì¶”ì²œ â†’ ì„ íƒ í™•ë¥  |
| top\_style\_requests | ì£¼ìš” ì„œìˆ  ì˜µì…˜ |
| user\_embedding\_v1 | user behavior embedding |

v2.2 ìˆ˜ì •:

JSON object í˜•ì‹ ëŒ€ì‹  **ê³ ì • ê¸¸ì´ ë²¡í„°** ì‚¬ìš©í•˜ì—¬ ML/ì‹¤ì‹œê°„ ì¡°íšŒ ìµœì í™”.

---

## **ğŸŸ¦ 4\. Vector DB Hybrid ì „í™˜**

### **ì¡°ê±´ ê¸°ë°˜ ì „í™˜:**

if user\_training\_data\_count \< N:  
    weight\_synthetic \= 1  
else:  
    weight\_synthetic \= 0

ë˜ëŠ” progressive hybrid:

weight\_synthetic \= max(0, 1 \- log(k))

Phase 2ì—ì„œëŠ” K.full\_document\_storeì˜ blocks\[\]ë¥¼ chunk ë‹¨ìœ„ë¡œ ë¶„ë¦¬í•˜ì—¬  
ê° chunkì— embedding\_v1ì„ ìƒì„±í•œ ë’¤ VectorDBì— ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.  
ì´ë•Œ embedding\_versionì€ ë¬¸ì¥(E)ê³¼ ë™ì¼í•œ ëª¨ë¸ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

---

## **ğŸŸ¦ 5\. Phase 2 ì™„ë£Œ ê¸°ì¤€**

* training\_examples(H) ìƒì„± ì„±ê³µë¥  99% ì´ìƒ  
* user\_profile(G) ìƒì„± ì„±ê³µë¥  97% ì´ìƒ  
* synthetic ì œê±° í…ŒìŠ¤íŠ¸ ì™„ë£Œ  
* dashboard: reco\_accept\_ratio, macro\_hit\_rate ì •ìƒ ë…¸ì¶œ

---

---

# **ğŸŸ¦ğŸŸ§ Phase 3: ê°œì¸í™” ì¶”ì²œ (v3.0)**

**ëª©í‘œ:**

Phase 2ì—ì„œ ì–»ì€ user\_profileì„ ê¸°ë°˜ìœ¼ë¡œ

ê°œì¸ë³„ë¡œ ë‹¤ë¥¸ ì¶”ì²œì„ ìƒì„±í•œë‹¤.

---

## **ğŸ”µ 1\. Phase 3 í•µì‹¬ ë³€í™”**

| ê¸°ëŠ¥ | ì„¤ëª… |
| :---- | :---- |
| user\_embeddings ìƒì„± | user\_profile ê¸°ë°˜ |
| P\_user ê³„ì¸µ ì¶”ê°€ | ê°œì¸í™” ì ìˆ˜ |
| cluster\_profile(J) ì¶”ê°€ | ìœ ì‚¬ ì‚¬ìš©ì ê¸°ë°˜ ì ìˆ˜ |
| P\_cluster ì¶”ê°€ | í´ëŸ¬ìŠ¤í„° ì ìˆ˜ |
| Strength predictor / Language predictor ê°œë°œ | êµì • ê°•ë„/ì–¸ì–´ ìë™ ì¶”ì²œ |

---

## **ğŸŸ¦ 2\. ì‚¬ìš©ì ì„ë² ë”©(user\_embeddings)**

ìƒì„± ë°©ë²• ì˜ˆì‹œ:

* RNN ê¸°ë°˜ sequence embedding  
* í‰ê·  í’€ë§ ê¸°ë°˜ ê°„ë‹¨ ì„ë² ë”©  
* BERT embedding ê¸°ë°˜ behavioral embedding  
* user\_profile â†’ linear projection

output: 384-dim ë˜ëŠ” 768-dim ë²¡í„°

---

## **ğŸŸ¦ 3\. í´ëŸ¬ìŠ¤í„° í”„ë¡œí•„(cluster\_profile)**

Phase 3ì—ì„œ ì²˜ìŒ ë“±ì¥í•˜ëŠ” ì‹ ê·œ ìŠ¤í‚¤ë§ˆ(J)

êµ¬ì„±:

* cluster\_id  
  cluster\_idëŠ” Phase 3ë¶€í„° ETLì´ user\_profileì— ì €ì¥í•˜ëŠ” ê°œë…ì´ë©°  
  cluster\_profile ì¡°íšŒëŠ” user\_profile â†’ cluster\_id â†’ profile ìˆœìœ¼ë¡œ ì´ë¤„ì§„ë‹¤.  
* centroid\_embedding  
* category\_vector  
* strength\_vector  
* language\_vector  
* last\_updated

---

## **ğŸŸ¦ 4\. ì¶”ì²œ ë¡œì§ í™•ì¥ (v3.0)**

P\_final \= f(  
  P\_vec,  
  P\_doc,  
  P\_user,  
  P\_cluster  
)

P\_user ê³„ì‚° ì˜ˆ:

P\_user \= cosine(user\_embedding, category\_centroid)

P\_cluster ê³„ì‚° ì˜ˆ:

P\_cluster \= cluster\_category\_vector\[reco\_category\]

---

## **ğŸŸ¦ 5\. Strength/Language Predictor**

Phase 3ì—ì„œ ë‹¤ìŒ 2ê°œ ëª¨ë¸ì´ ì¶”ê°€ë¨:

1. **strength\_predictor**  
   ì…ë ¥: context\_embedding \+ user\_embedding  
   ì¶œë ¥: "weak/moderate/strong"  
2. **language\_predictor**  
   ì…ë ¥: context\_embedding \+ user\_profile\_language\_vector  
   ì¶œë ¥: ì–¸ì–´(ko/en/jp ë“±)

---

## **ğŸŸ¦ 6\. Phase 3 ì™„ë£Œ ê¸°ì¤€**

* P\_user í™œì„±í™”  
* cluster\_profile ì¡°íšŒ 95% ì„±ê³µ  
* strength predictor ì •í™•ë„ ê¸°ì¤€ì¹˜ ë‹¬ì„±  
* ì–¸ì–´ predictor ì •í™•ë„ ê¸°ì¤€ì¹˜ ë‹¬ì„±

---

---

# **ğŸŸ¥ Phase 4: ì„œìˆ í˜• ì˜µì…˜ ìë™í™” (v4.0)**

**ëª©í‘œ:**

Phase 3ê¹Œì§€ëŠ” â€œì˜µì…˜ ì¶”ì²œâ€ì´ ëª©í‘œë¼ë©´,

Phase 4ë¶€í„°ëŠ” **ì„œìˆ í˜• ì˜µì…˜ì„ LLMì´ ìë™ ìƒì„±**í•˜ëŠ” ë‹¨ê³„ì´ë‹¤.

ì¦‰,

ì‚¬ìš©ìê°€ ì§ì ‘ â€œì¢€ ë” ê°„ê²°í•˜ê²Œâ€ ê°™ì€ ì„œìˆ í˜• ë¬¸ì¥ì„ ì“°ì§€ ì•Šì•„ë„

AIê°€ ë¬¸ë§¥ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±í•´ ì œì•ˆí•œë‹¤.

---

## **ğŸŸ¦ 1\. Phase 4 í•µì‹¬ ìš”ì†Œ**

| ìš”ì†Œ | ì„¤ëª… |
| :---- | :---- |
| Tone/Style Generator LLM | user\_prompt ìë™ ìƒì„± |
| Prompt Composer | Micro \+ Macro \+ User Profile \+ Cluster ëª¨ë‘ ê²°í•© |
| Full-Context LLM | ë¬¸ì„œ ì „ì²´ ê¸°ë°˜ êµì • ìˆ˜ì¤€ ê°•í™” |
| Feedback loop ê°•í™” | user\_prompt\_label í•™ìŠµ |

---

## **ğŸŸ¦ 2\. Tone/Style Generator**

ì…ë ¥ êµ¬ì„±:

* context\_embedding (E)  
* macro\_category\_hint (F)  
* user\_embedding (G)  
* cluster\_pattern (J)  
* ê¸°ì¡´ user\_prompt í†µê³„(D.user\_prompt)

ì¶œë ¥:

* ìì—°ì–´ ê¸°ë°˜ ì˜µì…˜ í…ìŠ¤íŠ¸  
* ì˜ˆ: â€œì¢€ ë” ê°„ê²°í•˜ê²Œâ€, â€œë” ì¼ìƒì ì¸ í‘œí˜„ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”â€

---

## **ğŸŸ¦ 3\. Prompt Composer (Phase 4 í•µì‹¬ ì—”ì§„)**

ìµœì¢… LLM inputì„ ìë™ ìƒì„±í•˜ëŠ” êµ¬ì„± ìš”ì†Œ.

ì…ë ¥:

* Micro context (ì„ íƒ ë¬¸ì¥)  
* Macro context (ë¬¸ì„œ ìš”ì•½)  
* user\_profile (ì„ í˜¸ë„)  
* user\_embeddings  
* style generator output  
* reco\_category / reco\_strength / reco\_language

ì¶œë ¥:

* LLMì—ê²Œ ì „ë‹¬í•˜ëŠ” ì™„ì„±ëœ instruction prompt

---

## **ğŸŸ¦ 4\. Phase 4 ì™„ë£Œ ê¸°ì¤€**

* ìŠ¤íƒ€ì¼ ì˜µì…˜ì„ ì‚¬ìš©ìê°€ ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ìë™ ìƒì„±ë¨  
* ì‚¬ìš©ìê°€ ì„ íƒ ê°€ëŠ¥  
* Feedback í•™ìŠµ ë£¨í”„ ì •ìƒ ì‘ë™  
* ì¶”ì²œ â†’ ì‹¤í–‰ â†’ ì„ íƒê¹Œì§€ End-to-End ìë™í™”

---

# **ğŸ“˜ PART 3 â€” ì „ì²´ ìŠ¤í‚¤ë§ˆ(v2.3 ì™„ì „ ì¬ì‘ì„±ë³¸)**

### ***(A\~I \+ í™•ì¥ ìŠ¤í‚¤ë§ˆ E/F/G/H/J \+ K í¬í•¨)***

### ***(í•„ë“œ ë‹¨ í•˜ë‚˜ë„ ëˆ„ë½ ì—†ì´ \+ v2.3 ìˆ˜ì •ì‚¬í•­ ë°˜ì˜ ë²„ì „)***

---

## **ğŸŸ¦ A. editor\_recommend\_options (Phase 1\~3 í•µì‹¬ ì‹¤ì‹œê°„ ë¡œê·¸)**

**ì„¤ëª…:** ì¶”ì²œì´ ìƒì„±ë  ë•Œë§ˆë‹¤ ê¸°ë¡ë˜ëŠ” ì‹¤ì‹œê°„ ì˜µì…˜ ì´ë²¤íŠ¸.

Phase ì—…ê·¸ë ˆì´ë“œì— ë”°ë¼ í•„ë“œ ì¦ê°€.

JSON

{  
  "insert\_id": "string",                    // PK, UUID  
  "recommend\_session\_id": "string",         // A/B/C/D ì—°ê²°ìš© ì„¸ì…˜ ID  
  "user\_id": "string",  
  "doc\_id": "string",  
  "context\_hash": "string",

  "reco\_category\_input": "string",          // ì¹´í…Œê³ ë¦¬ ì¶”ì²œ ê²°ê³¼(top-1)  
	"reco\_options": \["object"\], // í›„ë³´ ì˜µì…˜ ë¦¬ìŠ¤íŠ¸ (Phase 3+ë¶€í„° êµ¬ì¡°ì²´) /\* Phase 3 ì˜ˆì‹œ: { "category": "email", "strength": "moderate" } \*/

  "P\_vec":  { "category": "number" },       // vector ê¸°ë°˜ ì ìˆ˜ í…Œì´ë¸”  
  "P\_doc":  { "category": "number" },       // macro ê¸°ë°˜ ì ìˆ˜ (1.5+)  
  "P\_user": { "category": "number" },       // user ê¸°ë°˜ ì ìˆ˜ (3+)  
  "P\_cluster": { "category": "number" },    // cluster ê¸°ë°˜ ì ìˆ˜ (3+)

  "weight\_vec": "number",  
  "weight\_doc": "number",  
  "weight\_user": "number",  
  "weight\_cluster": "number",  
    
  "doc\_maturity\_score": "number",           // (ì‹ ê·œ) 0.0\~1.0 ë¬¸ì„œ ì„±ìˆ™ë„  
  "applied\_weight\_doc": "number",           // (ì‹ ê·œ) ì‹¤ì œ ì ìš©ëœ alpha ê°’

  "model\_version": "string",  
  "api\_version": "string",  
  "schema\_version": "string",

  "cache\_hit\_macro": "boolean",             // F(document\_context\_cache) hit ì—¬ë¶€  
  "cache\_hit\_user": "boolean",              // G(user\_profile)  
  "cache\_hit\_cluster": "boolean",           // J(cluster\_profile)

  "created\_at": "datetime",  
  "embedding\_version": "string",  
  "llm\_version": "string" (ì„ íƒ)  
}

---

## **ğŸŸ¦ B. editor\_run\_paraphrasing (Phase 1 ì‹¤í–‰ ì´ë²¤íŠ¸)**

**ì„¤ëª…:** ì¶”ì²œ ì˜µì…˜ì„ ì‹¤í–‰í–ˆì„ ë•Œ ë°œìƒí•˜ëŠ” ë¡œê·¸.

JSON

{  
  "source\_recommend\_event\_id": "string",   // A.insert\_id  
  "recommend\_session\_id": "string",

  "doc\_id": "string",  
  "user\_id": "string",

  "target\_language": "string",             // ko/en/jp ë“±  
  "target\_intensity": "string",            // weak / moderate / strong  
  "target\_category": "string",

  "executed\_at": "datetime",  
  "created\_at": "datetime",  
  "paraphrase\_llm\_version": "string"  
}

---

## **ğŸŸ¦ C. editor\_selected\_paraphrasing (Phase 1 ì„ íƒ ì´ë²¤íŠ¸)**

**ì„¤ëª…:** ìˆ˜ì • í›„ë³´ ì¤‘ ì‹¤ì œ ì„ íƒ ì—¬ë¶€.

JSON

{  
  "source\_recommend\_event\_id": "string",   // A.insert\_id  
  "recommend\_session\_id": "string",

  "user\_id": "string",  
  "doc\_id": "string",

  "selected\_option\_index": "int",          // ì„ íƒ ì•ˆí•˜ë©´ null  
  "was\_accepted": "boolean",

  "created\_at": "datetime",  
  "correction\_history\_id": "string",  
  "paraphrase\_llm\_version": "string"

}

---

## **ğŸŸ¦ D. correction\_history (ê¸°ì¡´ Ground Truth ìŠ¤í‚¤ë§ˆ)**

**ì„¤ëª…:** ê¸°ì—… ë ˆê±°ì‹œ Ground Truth.

JSON

{  
  "\_id": "string",                         // ObjectID ë¬¸ìì—´  
  "user": "string|null",                   // ObjectID string  
  "field": "string",                       // ì¹´í…Œê³ ë¦¬ ë¼ë²¨  
  "intensity": "string",                   // weak/moderate/strong  
  "user\_prompt": "string",                 // ìì—°ì–´ ì˜µì…˜ëª…  
  "input\_sentence": "string",  
  "output\_sentences": \["string"\],  
  "selected\_index": "int|null",  
  "created\_at": "datetime",

}

---

## **ğŸŸ¦ E. context\_block (Micro Context ìŠ¤í‚¤ë§ˆ / Phase 1 í•µì‹¬)**

**ì„¤ëª…:** ì„ íƒ êµ¬ê°„ ìœˆë„ìš° ë¬¸ë§¥ ë° ì„ë² ë”© ì €ì¥.

JSON

ì„¤ëª…: "ì„ íƒ êµ¬ê°„ ìœˆë„ìš° (Micro-Window)"ì˜ ë¬¸ë§¥ê³¼ ì„ë² ë”© ì €ì¥.  
{  
  "context\_hash": "string",        // PK: hash(doc\_id \+ context\_full)  
  "doc\_id": "string",  
  "user\_id": "string",             // (ì‹ ê·œ ì¶”ê°€)

  "selected\_text": "string",       // ë“œë˜ê·¸í•œ ì‹¤ì œ í…ìŠ¤íŠ¸  
  "context\_prev": "string",        // ì• ë¬¸ì¥  
  "context\_next": "string",        // ë’¤ ë¬¸ì¥

  "context\_preview": "string",     // UIìš© ë¯¸ë¦¬ë³´ê¸° (selected\_text)  
  "context\_full": "string",        // ì„ë² ë”© ë° ê²€ìƒ‰ìš© (prev \+ SEP \+ selected \+ SEP \+ next)

  "embedding\_v1": \["number"\],      // context\_full ê¸°ë°˜ ì„ë² ë”©  
  "embedding\_version": "string",   

  "source": "string",                
  "created\_at": "datetime"  
}

---

## **ğŸŸ¦ M\*\*. document\_chunk\*\***

**ì„¤ëª…:** K.full\_document\_storeì˜ ë¸”ë¡ ë‹¨ìœ„ ì„ë² ë”© ì €ì¥.

JSON

/\* ğŸŸ¦ M\_document\_chunk (ì‹ ê·œ ìŠ¤í‚¤ë§ˆ / Phase 2+) \*/  
/\* ì„¤ëª…: K.full\_document\_storeì˜ ë¸”ë¡ ë‹¨ìœ„ ì„ë² ë”© ì €ì¥. \*/  
{  
  "block\_hash": "string",        // PK (doc\_id \+ block\_indexì˜ í•´ì‹œ)  
  "doc\_id": "string",  
  "block\_index": "int",  
  "embedding\_v1": \["number"\],  
  "embedding\_version": "string",  
  "created\_at": "datetime"  
}

---

## **ğŸŸ¦ F. document\_context\_cache (Macro Context ìºì‹œ / Phase 1.5 í•µì‹¬)**

**ì„¤ëª…:** K.full\_document\_store ê¸°ë°˜ LLM ë¶„ì„ ê²°ê³¼ ì €ì¥ (K-V Cache).

JSON

{  
  "doc\_id": "string",                      // PK

  "macro\_topic": "string",                 // ë¬¸ì„œ ìš”ì•½ í† í”½  
  "macro\_category\_hint": "string",         // ë¬¸ì„œ ê¸°ë°˜ ì¶”ì²œ íŒíŠ¸

  "cache\_hit\_count": "int",  
  "last\_updated": "datetime",  
  "valid\_until": "datetime",               // TTL

  "invalidated\_by\_diff": "boolean",        // diff\_ratio â‰¥ 10% íŠ¸ë¦¬ê±°  
  "diff\_ratio": "number",                  // 0.0\~1.0

  "macro\_llm\_version": "string",  
  "schema\_version": "string"  
}

---

## **ğŸŸ¦ G. user\_profile (Phase 2 í•µì‹¬ ì‚°ì¶œë¬¼)**

**ì„¤ëª…:** ì‚¬ìš©ìë³„ ì„ í˜¸, ë¶„í¬, ì„ë² ë”© ë“± ì§‘ê³„.

v2.2: JSON ê°ì²´ ëŒ€ì‹  ML ìµœì í™”ë¥¼ ìœ„í•´ ì „ë¶€ ê³ ì • ê¸¸ì´ ë²¡í„°ë¡œ í†µì¼.

JSON

{  
  "user\_id": "string",                     // PK

  "preferred\_category\_vector": \["number"\], // length \= \#category  
  "preferred\_strength\_vector": \["number"\], // weak/moderate/strong  
  "preferred\_language\_vector": \["number"\], // ko/en/jp ë“±

  "recommend\_accept\_rate": "number",       // ì„ íƒë¥  í†µê³„  
  "paraphrase\_execution\_count": "int",  
  "embedding\_interaction\_count": "int",

  "user\_embedding\_v1": \["number"\],         // 384d or 768d  
  "updated\_at": "datetime",

  "schema\_version": "string",  
  "cluster\_id": "string"

}

phase2: cluster\_id \= null  
phase3 ë¶€í„° ì‚¬ìš©

---

## **ğŸŸ¦ H. training\_examples (Phase 2 í•™ìŠµ ë°ì´í„°)**

**ì„¤ëª…:** A/B/C/D/E/F ì „ì²´ë¥¼ ì¡°ì¸í•œ supervised ì˜ˆì œ.

JSON

{  
  "example\_id": "string",                  // PK  
  "recommend\_session\_id": "string",        // consistency check ê¸°ì¤€

  "user\_id": "string",  
  "doc\_id": "string",

  "context\_embedding": \["number"\],         // E  
  "macro\_category\_hint": "string|null",    // F

  "reco\_category\_input": "string",         // A  
  "reco\_scores\_vec": { "category": "number" },  
  "reco\_scores\_doc": { "category": "number|null" },

  "executed\_target\_language": "string|null",   // B  
  "executed\_target\_intensity": "string|null",  // B  
  "executed\_target\_category": "string|null",   // B

  "was\_accepted": "boolean|null",              // C  
  "selected\_option\_index": "int|null",         // C

  "groundtruth\_field": "string|null",          // D  
  "groundtruth\_intensity": "string|null",  
  "groundtruth\_user\_prompt": "string|null",  
  "groundtruth\_selected\_index": "int|null",

  "consistency\_flag": "string",                // high / low (v2.2 í•µì‹¬)  
  "created\_at": "datetime",

  "schema\_version": "string"  
}

---

## **ğŸŸ¦ I. recommend\_log (ì¶”ì²œ ë©”íŠ¸ë¦­ ë¶„ì„ìš©)**

**ì„¤ëª…:** ì¶”ì²œì˜ scoreÂ·ê°€ì¤‘ì¹˜Â·ëª¨ë¸ë²„ì „ ë“± ìƒì„¸ ë¡œê¹….

JSON

{  
  "log\_id": "string",

  "user\_id": "string",  
  "doc\_id": "string",  
  "recommend\_session\_id": "string",

  "P\_vec": { "category": "number" },  
  "P\_doc": { "category": "number" },  
  "P\_user": { "category": "number" },  
  "P\_cluster": { "category": "number" },

  "weight\_vec": "number",  
  "weight\_doc": "number",  
  "weight\_user": "number",  
  "weight\_cluster": "number",

  "latency\_ms": "number",  
  "cache\_hit\_macro": "boolean",  
  "cache\_hit\_user": "boolean",  
  "cache\_hit\_cluster": "boolean",

  "model\_version": "string",  
  "api\_version": "string",  
  "schema\_version": "string",

  "created\_at": "datetime"  
}

Phase 1ì—ì„œëŠ” P\_doc, P\_user, P\_cluster í•„ë“œì— {} (empty dict)ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤. (nullì´ ì•„ë‹˜)  
Phase 1.5ë¶€í„° í•„ë“œ ìƒì„±

---

## **ğŸŸ¦ J. cluster\_profile (Phase 3 ì‹ ê·œ ìŠ¤í‚¤ë§ˆ / í´ëŸ¬ìŠ¤í„° ê¸°ë°˜ Prior)**

JSON

{  
  "cluster\_id": "string",                      // PK

  "centroid\_embedding": \["number"\],  
  "category\_vector":  \["number"\],  
  "strength\_vector":  \["number"\],  
  "language\_vector":  \["number"\],

  "user\_count": "int",

  "last\_updated": "datetime",  
  "schema\_version": "string"  
}

---

## **ğŸŸ¦ K. full\_document\_store (Phase 1.5 Macro ì›ë³¸ ì €ì¥ì†Œ)**

**ì„¤ëª…:** ë¬¸ì„œ ì „ì²´ì˜ Diff ê¸°ë°˜ ì €ì¥ \+ LLM ë¶„ì„ì˜ ë‹¨ì¼ ì†ŒìŠ¤.

JSON

{  
  "doc\_id": "string",                          // PK

  "blocks": \[  
    {  
      "block\_index": "int",  
      "text": "string"  
    }  
  \],

  "latest\_full\_text": "string",  
  "previous\_full\_text": "string|null",

  "diff\_ratio": "number",                      // ë¶„ì„ìš©  
  "last\_synced\_at": "datetime",

  "schema\_version": "string"  
}  
diff\_ratio ê³„ì‚° ê³µì‹ (ì •ì˜ ì¶”ê°€)

ê¸°ë³¸ ë°©ì‹:  
diff\_ratio \= levenshtein\_distance(prev\_full\_text, full\_text) / max(len(prev\_full\_text), 1)

ë‹¨, ë¸”ë¡ ë‹¨ìœ„ ë³€ê²½ë„ ê°ì§€í•´ì•¼ í•˜ë¯€ë¡œ ë‹¤ìŒ ë³´ì¡° ê¸°ì¤€ ì‚¬ìš©:

\- block\_add\_ratio \= (ì¶”ê°€ëœ block ìˆ˜) / (ì „ì²´ block ìˆ˜)  
\- block\_del\_ratio \= (ì‚­ì œëœ block ìˆ˜) / (ì „ì²´ block ìˆ˜)

ìµœì¢… diff\_ratioëŠ” ë‹¤ìŒ ì¤‘ ìµœëŒ€ê°’ì„ ì‚¬ìš©í•œë‹¤:  
diff\_ratio \= max(  
    text\_diff\_ratio,  
    block\_add\_ratio,  
    block\_del\_ratio  
)  
text\_diff\_ratio \= levenshtein(prev\_full\_text, full\_text) / max(len(prev\_full\_text), 1)

block\_add\_ratio \= (\#added\_blocks) / total\_blocks  
block\_del\_ratio \= (\#deleted\_blocks) / total\_blocks

diff\_ratio \= max(text\_diff\_ratio, block\_add\_ratio, block\_del\_ratio)

## **ğŸŸ¦ L.editor\_document\_snapshot**

JSON

{  
  "snapshot\_id": "string",         // PK, UUID  
  "doc\_id": "string",  
  "user\_id": "string",

  "blocks": \[  
    {  
      "block\_index": "int",  
      "text": "string"  
    }  
  \],

  "full\_text": "string",           // ì „ì²´ ë¬¸ì„œ í•©ì³ì§„ í…ìŠ¤íŠ¸  
  "prev\_full\_text": "string|null", // ë°”ë¡œ ì§ì „ ìŠ¤ëƒ…ìƒ·ì—ì„œ ê°€ì ¸ì˜´ (ì„œë²„ ì¸¡)  
  "cursor\_position": "int|null",   // í”„ë¡ íŠ¸ì—ì„œ ì „ë‹¬ ê°€ëŠ¥

  "snapshot\_version": "string",    // v1.0  
  "schema\_version": "string",

  "created\_at": "datetime"  
}

diff\_ratioëŠ” ETLì´ full\_text vs prev\_full\_textë¥¼ ë¹„êµí•˜ì—¬ ê³„ì‚°í•œë‹¤.

---

# **ğŸ“˜ PART 4 â€” íŠ¸ëœì­ì…˜ ì „ì²´ ì¬ì‘ì„±ë³¸ (v2.3)**

### ***ì „ì²´ ì‹œìŠ¤í…œì˜ ì‹¤ì œ ë™ì‘ íë¦„ì„ ì‹œí€€ìŠ¤ì™€ ë‹¨ê³„ë³„ë¡œ ì •í™•íˆ ëª…ì„¸***

---

## **ğŸ”µ 4.1 ì „ì²´ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨(ì™„ì „ ì¬ì‘ì„±ë³¸)**

ì´ ë‹¤ì´ì–´ê·¸ë¨ì€ **ì¶”ì²œ(A)** â†’ **ì‹¤í–‰(B)** â†’ **ì„ íƒ(C)** â†’ **ì •ë‹µì§€(D)** â†’ **ì»¨í…ìŠ¤íŠ¸ ì €ì¥(E/K)** â†’ **ìºì‹±(F/G)** ì˜ ì „ì²´ íŠ¸ëœì­ì…˜ì„ í•œ ë²ˆì— ë³´ì—¬ì¤€ë‹¤.

ì½”ë“œ ìŠ¤ë‹ˆí«

sequenceDiagram  
    autonumber  
    actor User as ì‚¬ìš©ì  
    participant FE as í”„ë¡ íŠ¸ì—”ë“œ  
    participant API as ì¶”ì²œ API ì„œë²„  
    participant CacheF as F(document\_context\_cache)  
    participant CacheG as G(user\_profile)  
    participant VDB as Vector DB(E/global)  
    participant MQ as ë©”ì‹œì§€í(Kafka/SQS)  
    participant DB as DB(K/E/D/F/G/H/K)

    %% \------- 1\. ì¶”ì²œ ìš”ì²­ (A) \-------  
    User-\>\>FE: ë¬¸ì¥ ë“œë˜ê·¸  
    FE-\>\>API: /recommend(doc\_id, context\_text, user\_id)

    %% \--- Phase ì¡°ê±´ì— ë”°ë¼ Macro/User Profile ì¡°íšŒ \---  
    API-\>\>CacheF: macro\_context ì¡°íšŒ(doc\_id)\\n(Phase 1.5+)  
    CacheF--\>\>API: macro\_category\_hint(P\_doc)

    API-\>\>CacheG: user\_profile ì¡°íšŒ(user\_id)\\n(Phase 3+)  
    CacheG--\>\>API: user feature(P\_user)

    %% \--- Vector Search (Micro Context) \---  
    API-\>\>VDB: vector search(context embedding v1)  
    VDB--\>\>API: P\_vec

    API-\>\>API: P\_final \= (1-Î±)P\_vec \+ Î±P\_doc \+ ...

		API \--\> FE: ì¶”ì²œ ì˜µì…˜ ë¦¬ìŠ¤íŠ¸ \+ insert\_id \+ recommend\_session\_id ë°˜í™˜  
    FE--\>\>User: ì¶”ì²œ í›„ë³´ í™”ë©´ í‘œì‹œ

    %% \------- 2\. ì¶”ì²œ ì´ë²¤íŠ¸ ì €ì¥ (A / I / E) \-------  
    API-\>\>MQ: editor\_recommend\_options(A) ë°œí–‰  
    API-\>\>MQ: recommend\_log(I) ë°œí–‰  
    API-\>\>MQ: context\_block(E) ë°œí–‰

    par ë¹„ë™ê¸° ì €ì¥  
        MQ-\>\>DB: A ì €ì¥(editor\_recommend\_options)  
        MQ-\>\>DB: I ì €ì¥(recommend\_log)  
        MQ-\>\>DB: E ì €ì¥(context\_block)\\n(embedding\_v1, preview)  
    end  
		API \--\> EmbeddingModel : context embedding ìƒì„±

    %% \------- 3\. ë¬¸ì„œ ì €ì¥ (Full Document Store \- K) \-------  
    User-\>\>FE: ë¬¸ì„œ ì €ì¥/ìë™ì €ì¥  
    FE-\>\>MQ: editor\_document\_snapshot ë°œí–‰  
    MQ-\>\>DB: full\_document\_store(K) ì—…ë°ì´íŠ¸\\n(latest\_full\_text, diff\_ratio)

		ETL \--\> MacroLLM : ë¬¸ì„œ ì „ì²´ ë¶„ì„

		%% \------- 4\. ì‹¤í–‰(B) \- LLM í˜¸ì¶œë§Œ ë°œìƒ \-------  
		User-\>\>FE: ì‹¤í–‰ ë²„íŠ¼ í´ë¦­  
		FE-\>\>MQ: editor\_run\_paraphrasing(B)\\n(source\_recommend\_event\_id í¬í•¨)  
		MQ-\>\>DB: B ì €ì¥(editor\_run\_paraphrasing)  
		MQ \--\> ParaphrasingLLM : í›„ë³´ ë¬¸ì¥ paraphrase ìƒì„±  
		  
		%% \------- 5\. ì„ íƒ(C) \+ ì •ë‹µì§€ ìƒì„±(D) \-------  
		User-\>\>FE: í›„ë³´ ì¤‘ 1ê°œ ì„ íƒ  
		FE-\>\>MQ: editor\_selected\_paraphrasing(C)\\n(index, was\_accepted)  
		  
		par  
				MQ-\>\>DB: C ì €ì¥(editor\_selected\_paraphrasing)  
				MQ-\>\>DB: (if C.was\_accepted) correction\_history(D) ìƒì„±  
				MQ-\>\>DB: C.correction\_history\_id ì—…ë°ì´íŠ¸ (D.\_id)		      
		end  
		  
    %% \------- 6\. (Offline) Macro Context ìºì‹œ ê°±ì‹  (F) \-------  
    DB-\>\>DB: ETL ì½ê¸°(K.full\_document\_store)  
    DB-\>\>DB: LLM Macro ë¶„ì„(macro\_topic, macro\_category\_hint)  
    DB-\>\>CacheF: document\_context\_cache(F) ê°±ì‹ \\n(valid\_until \+ TTL)

    %% \------- 7\. (Offline) User Profile ìƒì„± (G) \-------  
    DB-\>\>DB: ETL ì¡°ì¸(B, C, D)  
    DB-\>\>CacheG: user\_profile ì—…ë°ì´íŠ¸\\n(preferred dist, accept rate, embeddings)

---

## **ğŸ”µ 4.2 Step-by-step ì²˜ë¦¬ íë¦„ (ëª¨ë“  ë‹¨ê³„ ìƒì„¸ ì‘ì„±)**

**ì´ 7ë‹¨ê³„**ë¡œ ë‚˜ëˆ„ì–´, ì‹¤ì œ ì‹œìŠ¤í…œì´ ì–´ë–¤ ìˆœì„œë¡œ ì›€ì§ì´ëŠ”ì§€ ì„¤ëª…í•œë‹¤.

---

## **â‘  ì¶”ì²œ í˜¸ì¶œ ë‹¨ê³„ (A â€” editor\_recommend\_options)**

### **ì…ë ¥**

* doc\_id  
* user\_id  
* selected\_text  
* context\_prev  
* context\_next  
* (Phase 2 ì´í›„) context embedding v1

### **ì²˜ë¦¬ ë¡œì§**

1. APIëŠ” selected\_text, context\_prev, context\_nextë¥¼ ì¡°í•©í•˜ì—¬ context\_fullì„ ìƒì„±  
2. context\_hash ê³„ì‚° (hash(doc\_id \+ context\_full))  
3. context\_hash ê¸°ì¤€ìœ¼ë¡œ E.context\_block ì¡°íšŒ (Upsert)  
4. (Upsert ì‹œ) EmbeddingModel(context\_full)ì„ í˜¸ì¶œí•˜ì—¬ embedding\_v1 ìƒì„± ë° ì €ì¥  
5. embedding\_v1ì„ ì¿¼ë¦¬ë¡œ Vector Search(P\_vec) ìˆ˜í–‰  
6. (Rule Engine ì œê±°ë¨)  
7. Phase ì¡°ê±´ì— ë”°ë¼:  
   * Phase 1 â†’ P\_doc \= default, P\_user \= default  
   * Phase 1.5 â†’ P\_doc í™œì„± (ë¬¸ì„œ ì„±ìˆ™ë„ì— ë”°ë¥¸ Î± ì ìš©)  
   * Phase 3 â†’ P\_doc \+ P\_user í™œì„±  
8. P\_final \= (1 \- Î±) \* P\_vec \+ Î± \* P\_doc \+ ...  
9. insert\_id ìƒì„± â†’ FEë¡œ ë°˜í™˜  
10. APIëŠ” **A / I / E** 3ê°œì˜ ì´ë²¤íŠ¸ë¥¼ MQë¡œ ë°œí–‰í•œë‹¤.

### **ì¶œë ¥**

* ì¶”ì²œ í›„ë³´ ë¦¬ìŠ¤íŠ¸  
* insert\_id (= source\_recommend\_event\_id)

---

## **â‘¡ ì¶”ì²œ ê²°ê³¼ ì €ì¥(A), ì¶”ì²œ ë¡œê·¸(I), ì»¨í…ìŠ¤íŠ¸ ì €ì¥(E)**

### **ì €ì¥ë˜ëŠ” ìŠ¤í‚¤ë§ˆ**

* A â†’ editor\_recommend\_options  
* I â†’ recommend\_log  
* E â†’ context\_block

### **ì—­í• **

* A \= ì¶”ì²œ ê²°ê³¼ì˜ "ì…ì¶œë ¥ ì „ì²´ ìŠ¤ëƒ…ìƒ·"  
* I \= ì¶”ì²œ ë¡œì§ ë‚´ë¶€ì˜ ëª¨ë¸ score/weight ê¸°ë¡  
* E \= Micro-context ì €ì¥ì†Œ (Phase 2 Vector Hybridì˜ ê¸°ë°˜)

---

## **â‘¢ ë¬¸ì„œ ì €ì¥ â†’ Macro ì›ë³¸ ì €ì¥(K.full\_document\_store)**

### **íë¦„**

1. ì‚¬ìš©ìê°€ ë¬¸ì„œ ì €ì¥/ìë™ì €ì¥ì„ í•˜ë©´ FEëŠ” editor\_document\_snapshot ë°œí–‰  
2. MQê°€ ìˆ˜ì‹ í•˜ì—¬ K í…Œì´ë¸” ì—…ë°ì´íŠ¸  
   FE â†’ MQ(snapshot ì „ë‹¬)  
   MQ consumer â†’  
   K.previous\_full\_text â† K.latest\_full\_text  
   K.latest\_full\_text â† snapshot.full\_text  
   diff\_ratio ê³„ì‚°  
   blocks ì—…ë°ì´íŠ¸  
3. í…ìŠ¤íŠ¸ë¥¼ ë¸”ë¡ë³„ë¡œ ì €ì¥í•˜ê³  diff\_ratioë¥¼ ê¸°ë¡

### **ì—­í• **

* Macro Context ë¶„ì„(F.document\_context\_cache)ì˜ **ìœ ì¼í•œ ì›ë³¸ ì €ì¥ì†Œ**

---

## **â‘£ ì‹¤í–‰(B) ì²˜ë¦¬**

### **íë¦„**

1. ì‚¬ìš©ìê°€ â€œì‹¤í–‰â€ì„ ëˆ„ë¥´ë©´ FEëŠ” editor\_run\_paraphrasing ë°œí–‰  
2. LLM ì•„ì›ƒí’‹ ìƒì„± \+ ì‹¤í–‰ íŒŒë¼ë¯¸í„° ë¡œê·¸ë§Œ ë‚¨ê¹€  
3. B ì´ë²¤íŠ¸ì—:  
   * source\_recommend\_event\_idë¥¼ í¬í•¨í•˜ì—¬ ì €ì¥

   B ì´ë²¤íŠ¸ì—ëŠ” correction\_history\_idê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.B ì €ì¥ ìŠ¤í‚¤ë§ˆëŠ” ë‹¤ìŒ ë‘ ê°’ë§Œ ê°€ì§„ë‹¤:

   * source\_recommend\_event\_id (A.insert\_id)  
   * recommend\_session\_id

correction\_history\_idëŠ” C(ì„ íƒ)ê°€ ë°œìƒí•œ ìˆœê°„D(correction\_history)ê°€ ìƒì„±ë˜ë©´ì„œ ë¶€ì—¬ë˜ê³ ,C ì´ë²¤íŠ¸ì—ë§Œ ì €ì¥ëœë‹¤.B ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹œ MQ consumerëŠ” Paraphrasing LLMì„ í˜¸ì¶œí•˜ì—¬ ì˜µì…˜ í›„ë³´ë¥¼ ìƒì„±í•œë‹¤.ì´ LLM í˜¸ì¶œì€ ì‹¤í–‰(B) ì‹œì ì—ì„œë§Œ ë°œìƒí•˜ë©°, D ìƒì„±ê³¼ëŠ” ë¬´ê´€í•˜ë‹¤.

### **ì—­í• **

* ì‹¤í–‰ ì‹œì ì˜ â€œì‚¬ìš©ì ì„¤ì •ê°’ Ground Truthâ€  
* D ìŠ¤í‚¤ë§ˆì™€ A ì´ë²¤íŠ¸ë¥¼ **Micro-Context ë‚´ì—ì„œ** ì—°ê²°í•˜ëŠ” í•µì‹¬ Linker

BëŠ” correction\_history(D)ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ”ë‹¤.

BëŠ” ì˜¤ì§ source\_recommend\_event\_idì™€ recommend\_session\_idë§Œ ê°€ì§„ë‹¤.

DëŠ” ë°˜ë“œì‹œ C(editor\_selected\_paraphrasing)ê°€ ë°œìƒí–ˆì„ ë•Œ ìƒì„±ëœë‹¤.

---

## **â‘¤ ì„ íƒ(C) ì²˜ë¦¬**

### **íë¦„**

1. ì‚¬ìš©ìê°€ í›„ë³´ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´ FEëŠ” editor\_selected\_paraphrasing ë°œí–‰  
2. MQê°€ DBì— ì €ì¥  
3. C ì´ë²¤íŠ¸ì—ë„:  
   * source\_recommend\_event\_id  
   * correction\_history\_idê°€ í¬í•¨ë˜ì–´ì•¼ í•¨  
     * ì´ë•Œ ìƒˆ Dë¥¼ ìƒì„±í•˜ê³ , ê·¸ \_idë¥¼ Cì— ì‹¬ëŠ”ë‹¤

### **ì—­í• **

* ì„ íƒ ì—¬ë¶€(was\_accepted) Ground Truth  
* B, Dì™€ì˜ ì¡°ì¸ì„ í†µí•´ user\_profile(G)ì™€ training\_examples(H) ìƒì„±

---

## **â‘¥ Macro Context Cache ê°±ì‹ (F)**

### **ì†ŒìŠ¤**

* K.full\_document\_store

### **í”„ë¡œì„¸ìŠ¤**

ETLì€ K.full\_document\_storeë¥¼ LLMì—ê²Œ ì „ë‹¬í•˜ì—¬ macro\_topic, macro\_category\_hintë¥¼ ì¶”ë¡ í•œë‹¤.  
ì´ Macro LLM í˜¸ì¶œì€ diff\_ratio â‰¥ 10% ë˜ëŠ” TTL ë§Œë£Œ ì‹œì—ë§Œ ë°œìƒí•œë‹¤.

1. ETLì´ K í…Œì´ë¸”ì„ ì½ì–´ ë¬¸ì„œ ë‹¨ìœ„ full\_text ì¬êµ¬ì„±  
2. diff\_ratioâ‰¥X%ì´ë©´ ìºì‹œ ë¬´íš¨í™”  
3. LLM ë¶„ì„ìœ¼ë¡œ:  
   * macro\_topic  
   * macro\_category\_hint  
4. Redis ë“± ìºì‹œì— ì €ì¥ (TTL ë¶€ì—¬)

### **ê²°ê³¼**

* /recommend APIì—ì„œ doc\_id ì¡°íšŒ ì‹œ **ì¦‰ì‹œ P\_doc ë°˜ì˜**

---

## **â‘¦ User Profile ìºì‹œ(G) ìƒì„±**

### **ì†ŒìŠ¤**

* C (was\_accepted)  
* D (field, intensity, user\_prompt)  
* B (target\_language)

### **ì¶œë ¥**

* preferred distributions  
* recommend\_accept\_rate  
* user\_embedding\_v1

Phase 3ì—ì„œ /recommendí•  ë•Œ ì¦‰ì‹œ ì¡°íšŒë˜ì–´ **P\_user ê³„ì‚°**ì— ì‚¬ìš©ë¨.

---

## **ğŸ”µ 4.3 A â†” B â†” C â†” D í‚¤ ì—°ê²° ê·œì¹™ (Consistency Rule)**

ì´ ê·œì¹™ì´ ì§€ì¼œì ¸ì•¼ ETL/í•™ìŠµ ë°ì´í„°(H)ì—ì„œ 100% ì •í•©ì„± ìˆëŠ” ë ˆì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

---

## **Rule 1 â€” recommend\_session\_id (ë…¼ë¦¬ì  ì„¸ì…˜ ID)**

* A ìƒì„± ì‹œ ìƒì„±ë¨  
* \~\~B/C/D/Hì—ì„œ **ë°˜ë“œì‹œ ë™ì¼í•œ recommend\_session\_idë¥¼ ê³µìœ **í•´ì•¼ í•¨\~\~

A/B/Cë§Œ recommend\_session\_idë¥¼ ê³µìœ í•˜ë©°  
DëŠ” recommend\_session\_idë¥¼ ê°€ì§€ì§€ ì•ŠëŠ”ë‹¤.  
DëŠ” C.correction\_history\_idë¡œë§Œ ì—°ê²°ëœë‹¤.  
ETLì—ì„œ DëŠ” (correction\_history\_id)ë¡œ JOINí•œë‹¤.

* ì„¸ì…˜ ë‹¨ìœ„ ë¶„ì„ì— ì‚¬ìš©ë¨  
* ì˜ˆ: í•œ ë¬¸ì¥ ë“œë˜ê·¸ â†’ ì‹¤í–‰ â†’ ì„ íƒì˜ ì „ì²´ íë¦„ì„ ë¬¶ëŠ” í‚¤

---

## **Rule 2 â€” source\_recommend\_event\_id (= A.insert\_id)**

* A.insert\_idëŠ” Mixpanel insert\_idì™€ ë™ì¼  
* Bì™€ CëŠ” ë°˜ë“œì‹œ ì´ ê°’ì„ FKë¡œ í¬í•¨í•´ì•¼ í•œë‹¤  
* ìˆ˜í–‰ ì›ì²œì´ ì–´ë–¤ ì¶”ì²œ(A)ì´ì—ˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œ

---

## **Rule 3 â€” correction\_history\_id (= D.\_id)**

* C ì´ë²¤íŠ¸ê°€ triggerê°€ ë˜ì–´ D(correction\_history)ë¥¼ ìƒì„±í•œë‹¤.  
* Dê°€ ìƒì„±ë˜ë©´:  
  * D.\_idë¥¼ ìƒì„±í•œë‹¤.  
  * C.correction\_history\_id \= D.\_idë¡œ ì„¸íŒ…í•œë‹¤.  
* BëŠ” correction\_history\_idë¥¼ ê°–ì§€ ì•Šê³ , A/B/CëŠ” source\_recommend\_event\_id \+ recommend\_session\_idë¡œ ë¬¶ì¸ë‹¤.  
* ìµœì¢… Ground Truth(D)ë¥¼ ì—¬ëŸ¬ ì´ë²¤íŠ¸(B/C)ê°€ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡°  
* DëŠ” í…ìŠ¤íŠ¸Â·ì„¤ì •ê°’ì˜ ìµœì¢… ê·¼ê±°

---

## **Rule 4 â€” doc\_id ì •í•©ì„±**

ëª¨ë“  ì´ë²¤íŠ¸ê°€ ë°˜ë“œì‹œ ë™ì¼ doc\_idë¥¼ ê°€ì ¸ì•¼ í•¨

(ë‹¤ë¥´ê²Œ ë˜ë©´ Macro Context(K/F)ì™€ Micro Context(E)ê°€ ì—‰í‚´)

---

## **Rule 5 â€” Phase ì¡°ê±´ì— ë”°ë¥¸ P\_doc/P\_user ê·œì¹™**

| Phase | P\_vec | P\_doc | P\_user |
| :---- | :---- | :---- | :---- |
| 1 | ON | default(0) | default(0) |
| 1.5 | ON | ON (ë™ì ê°€ì¤‘ì¹˜) | default(0) |
| 2 | ON (Hybrid ì¤€ë¹„) | ON | default(0) |
| 3 | ON | ON | ON |

---

## **ğŸ”µ 4.4 ìºì‹œ ë¬´íš¨í™” / ì¬ê³„ì‚° ê·œì¹™**

### **Rule 1 â€” Macro Cache(F) ë¬´íš¨í™”**

* diff\_ratio â‰¥ 0.10 (10% ì´ìƒ ë³€ê²½) â†’ í•´ë‹¹ doc\_id ìºì‹œ ì‚­ì œ  
* diff\_ratio \< 0.10 â†’ TTL ë‚´ ìœ ì§€

### **Rule 2 â€” User Profile(G) ì¬ê³„ì‚°**

* í•˜ë£¨ 1íšŒ ê¸°ë³¸  
* ë‹¤ìŒ ì¡°ê±´ ì¤‘ í•˜ë‚˜ë¼ë„ ë§Œì¡±í•˜ë©´ ì¦‰ì‹œ ì¬ê³„ì‚°:  
  * ìµœê·¼ 10ê±´ì—ì„œ was\_accepted ë³€í™”ëŸ‰ì´ 20% ì´ìƒ  
  * ìƒˆë¡œìš´ user\_promptê°€ ì¶”ê°€ë¨  
  * ìƒˆë¡œìš´ field/intensityê°€ ìœ ì…ë¨

---

## **ğŸ”µ 4.5 Training Examples(H) ìƒì„± ê·œì¹™**

ETLì€ ë‹¤ìŒ 7ê°œ ì—”í‹°í‹°ë¥¼ Joiní•˜ì—¬ 1ê°œì˜ sampleì„ ìƒì„±í•œë‹¤:

| ì—”í‹°í‹° | ì—­í•  |
| :---- | :---- |
| A | ì¶”ì²œ ì…ë ¥ê°’ |
| I | ëª¨ë¸ ì ìˆ˜/ê°€ì¤‘ì¹˜ |
| E | context embedding |
| F | macro hint ì…ë ¥ |
| B | ì‹¤í–‰ ì‹œ ì„¤ì • Ground Truth |
| C | ì„ íƒ ì—¬ë¶€ Ground Truth |
| D | í…ìŠ¤íŠ¸ Ground Truth |

---

## **ğŸ”µ 4.6 ìµœì¢… ìš”ì•½ â€” ì¶”ì²œ â†’ ì‹¤í–‰ â†’ ì„ íƒ â†’ í•™ìŠµì˜ ì™„ì „ ë£¨í”„**

1. A: ì¶”ì²œ ìƒì„±  
2. E/I ì €ì¥ \+ context ì €ì¥  
3. K ì €ì¥  
4. B: ì‹¤í–‰  
5. D: ì •ë‹µì§€ ìƒì„±  
6. C: ì„ íƒ  
7. F/G ìºì‹œ ê°±ì‹   
8. H: í•™ìŠµ ë°ì´í„° ìƒì„±  
9. ë‹¤ì‹œ Aì—ì„œ P\_user/P\_doc ë°˜ì˜ â†’ í’ˆì§ˆ í–¥ìƒ

ì™„ì „í•œ **ê°•í™”(loop) êµ¬ì¡°** ì™„ì„±.